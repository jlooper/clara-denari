---
import Nav from '../components/Nav.astro';
import Inventory from '../components/Inventory.vue';
import Footer from '../components/Footer.astro';
import Notification from '../components/Notification.astro';
import SandboxPopup from '../components/SandboxPopup.astro';
import AboutModal from '../components/AboutModal.astro';
import '../styles/global.css';

export interface Props {
  title: string;
  backdrop?: string;
  fullScreenLayout?: boolean;
}

const { title, backdrop, fullScreenLayout = false } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Clara Denari Adventures by Cloudinary - Learn about image transformations hands-on.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clara Denari Adventures - a Cloudinary Mystery - {title}</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y7S9N6GLK2"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-Y7S9N6GLK2');
    </script>
  </head>
  <body>
    <div class="wrapper">
      <div class="markdown-body font-serif m-1 sm:m-2 md:m-4 lg:m-8 text-base rounded-lg relative overflow-hidden">
        <Nav />
        <SandboxPopup />        
        <div class="flex">
          {!fullScreenLayout && (
            <div role="complementary" class="lg:inline-block md:inline-block sm:inline-block w-1/3">
              <Inventory client:load />
            </div>
          )}
          <div role="main" class="w-full">
            <slot />
          </div>
        </div>

        <Footer />
      </div>
    </div>
    
    <Notification id="global-notification" type="info" message="" />
    <AboutModal />
  </body>
</html>

<style>
  .backdrop {
    background-repeat: no-repeat;
  }
</style>

<script>
  // Keyboard navigation
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('button');
    let currentFocusIndex = 0;

    // Add tabindex to buttons for keyboard navigation
    buttons.forEach((button, index) => {
      button.setAttribute('tabindex', '0');
    });

    // Handle keyboard navigation
    document.addEventListener('keydown', (e) => {
      switch(e.key) {
        case 'ArrowRight':
        case 'ArrowDown':
          e.preventDefault();
          currentFocusIndex = (currentFocusIndex + 1) % buttons.length;
          buttons[currentFocusIndex].focus();
          break;
        case 'ArrowLeft':
        case 'ArrowUp':
          e.preventDefault();
          currentFocusIndex = (currentFocusIndex - 1 + buttons.length) % buttons.length;
          buttons[currentFocusIndex].focus();
          break;
        case 'Enter':
        case ' ':
          if (document.activeElement && document.activeElement.tagName === 'BUTTON') {
            e.preventDefault();
            (document.activeElement as HTMLElement).click();
          }
          break;
      }
    });

    // Focus first button on page load
    if (buttons.length > 0) {
      buttons[0].focus();
    }
  });

  