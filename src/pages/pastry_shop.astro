---
import Layout from '../layouts/Layout.astro';
import Page from '../components/Page.astro';
import GameAction from '../components/GameAction.vue';
import GameLayout from '../components/GameLayout.astro';
import Typewriter from '../components/Typewriter.astro';
import NotificationPanel from '../components/NotificationPanel.astro';
import { translations } from '../i18n/translations.js';

const title = 'page.pastry_shop';
const backdrop = "https://res.cloudinary.com/dr60nybtj/image/upload/fl_c2pa/v1757718429/cd_cannoli.png";

// Story text is now handled by translations
---

<Layout title={title} backdrop={backdrop} fullScreenLayout={true}>
    <div class="prose max-w-none">
      <!-- Main content area with image and inventory side by side -->
      <GameLayout title={title} backdrop={backdrop} />
      
      <!-- Full width storyline -->
      <div class="w-full mb-6">
        <h2 id="page-title" class="text-2xl font-bold text-blue-400 mb-4 shadow-lg" data-page-key="pastry_shop">
          The Pastry Shop
        </h2>
        
        <div class="bg-black bg-opacity-50 border-2 border-blue-500 rounded-lg p-6 mb-6">
          <Typewriter 
            translationKey="story.pastry_shop"
            speed={30}
            delay={1000}
            class="block mb-4 text-gray-100 text-lg leading-relaxed"
          />
        </div>
      </div>
      
      <!-- Notification Panel -->
      <NotificationPanel />
      
      <!-- Full width items and buttons -->
      <div class="w-full">
        <div class="flex flex-col sm:flex-row gap-4 justify-center mb-6">
          
           <!-- Inventory item -->
        <!-- Text-only action -->
        <GameAction 
          id="recycle" 
          actionType="text" 
          textKey="gameaction.dunk_cannoli.text"
          resultKey="gameaction.dunk_cannoli.result"
          customText="Dunk the cannoli into a latte"
          customResult="There's now ricotta cheese all over the place."
          client:load 
        />

     

        <GameAction id="3" actionType="item" client:load />
        
       
          <Page 
            url="lab_3" 
            actionKey="page.action.go_to_lab" 
            condition="3"
            resultText="Off you go!"
          />
          
         
        </div>
      </div>
    </div>
  </Layout>

<script define:vars={{ translations }}>
  document.addEventListener('DOMContentLoaded', () => {
    function loadTitle() {
      const titleElement = document.getElementById('page-title');
      if (titleElement) {
        const currentLang = localStorage.getItem('preferred-language') || 'en';
        const fallbackLang = currentLang === 'pt-br' ? 'en' : currentLang;
        const translation = translations['page.pastry_shop'];
        const text = translation[fallbackLang] || translation['en'] || 'The Pastry Shop';
        titleElement.textContent = text;
      }
    }
    loadTitle();
    window.addEventListener('language-changed', loadTitle);
  });
</script> 