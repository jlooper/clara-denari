---
import Layout from '../layouts/Layout.astro';
import GameLayout from '../components/GameLayout.astro';
import NotificationPanel from '../components/NotificationPanel.astro';
import Page from '../components/Page.astro';

const title = "Lab 2";
const backdrop = "https://res.cloudinary.com/dr60nybtj/image/upload/e_sepia/twine";
---

<Layout title={title} backdrop={backdrop} fullScreenLayout={true}>
  <div class="prose max-w-none">
    <!-- Main content area with image and inventory side by side -->
    <GameLayout title={title} backdrop={backdrop} imageClass="lg:w-1/3 md:w-1/3" />
    
    <!-- Full width storyline -->
    <div class="w-full mb-6">
      <h1 class="text-3xl font-bold text-green-500 mb-4" style="text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);">
        {title}
      </h1>
      
      <div class="bg-black bg-opacity-50 border-2 border-blue-500 rounded-lg p-6 mb-6">
        <p class="text-green-500 text-lg leading-relaxed" style="text-shadow: 0 0 3px rgba(0, 255, 0, 0.5);">
         This grimy string needs to be cleaned so you can view its original color. Tip: remove the sepia transformation in the transformation field to view the original in the lab view.
        </p>
        
       
      </div>
    </div>
    
    <!-- Notification Panel -->
    <NotificationPanel />
    
    <!-- Lab Button -->
    <div class="w-full flex flex-col sm:flex-row gap-4 justify-center">
      <button 
        id="sandbox-btn"
        class="bg-gradient-to-br from-gray-800 to-gray-900 text-gray-400 border-2 border-blue-600 px-6 py-3 text-lg rounded-lg hover:from-amber-700 hover:to-amber-800 hover:text-white transition-all duration-200 shadow-lg font-bold"
        style="text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);"
      >
        ðŸ§ª Lab
      </button>
    </div>
    
  
  </div>
</Layout>

<script>
  // Check if lab is completed and show continue button
  document.addEventListener('DOMContentLoaded', () => {
    function checkLabCompletion() {
      const results = JSON.parse(localStorage.getItem('labResults') || '[]');
      const labCompleted = results.some((result: any) => result.lab === 'Lab 2' && result.correct === true);
      
      const continueSection = document.getElementById('continue-section');
      if (continueSection) {
        if (labCompleted) {
          continueSection.style.display = 'flex';
        } else {
          continueSection.style.display = 'none';
        }
      }
    }
    
    // Check on page load
    checkLabCompletion();
    
    // Listen for lab completion events
    window.addEventListener('labCompleted', checkLabCompletion);
    
    // Also check periodically in case localStorage is updated from another tab
    setInterval(checkLabCompletion, 1000);
  });
</script> 